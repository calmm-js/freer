!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("infestines")):"function"==typeof define&&define.amd?define(["exports","infestines"],r):r(n.freer={},n.I)}(this,function(n,c){"use strict";function f(n,r){this.p=n,this.s=r}function r(n){this.v=n}function t(n){this.f=n}var u=function(n){return Promise.resolve(n)},s=function(n){return n instanceof r},e=(0,c.id)(function(n,r){this.e=n,this.c=r}),i=function(n,r){return new e(n,r)},v=function(n){return n instanceof e},a=function(n,r){return v(n)?i(n.e,new f(n.c,r)):i(n,r)},o=function(n,r){return s(r)?n(r.v):a(r,n)},d=function(r,n){return s(n)?h(r(n.v)):a(n,function(n){return h(r(n))})},p=function(n,r){return s(n)?d(n.v,r):a(n,function(n){return d(n,r)})},h=function(n){return new r(n)},y=c.curry(o),l=c.curry(d),w=c.curry(p),m={map:d,of:h,ap:p,chain:o},x=c.curry(function(i,o){return function t(n,r){if(s(n))return i(n.v,r);var u,e=void 0;return u=v(n)?(e=n.c,n.e):(e=h,n),o(u,function(n,r){return t(function(n,r){for(;!c.isFunction(n);){var t=n.p;for(n=n.s;!c.isFunction(t);)n=new f(t.s,n),t=t.p;var u=t(r);if(!s(u))return a(u,n);r=u.v}return n(r)}(e,n),r)},r)}}),F=x(u,function(n,r){return null!=(t=n)&&c.isFunction(t.then)?n.then(r):o(r,n);var t}),b=function(){var r=void 0,n=new Promise(function(n){return r=n});return n.v=r,n},P=x(u,function(n,r){return o(r,n instanceof t?function(n){var r=b(),t=void 0;n(function(n){return t=b(),r.v(n),t}).then(function(n){t=null,r.v(n)});var u=function(n){return t?(r=b(),o(e,n)):h(n)},e=function(n){return t.v(n),o(u,r)};return o(u,r)}(n.f):n)});n.of=h,n.chain=y,n.map=l,n.ap=w,n.Free=m,n.run=function(r){return s(r)?r.v:function(n){throw Error("Expected a pure value, but got: "+r)}()},n.runAsync=F,n.from=function(n){return new t(n)},n.toAsync=P,n.handler=x,n.Reader=function(){var u=new function(){},e=c.curryN(2,function(t){return x(h,function(n,r){return n===u?r(t):o(r,n)})}),n=c.curry(function(r,t){return o(function(n){return e(r(n),t)},u)});return{ask:u,local:n,run:e}},n.State=function(){function u(n){this.v=n}var e=new function(){},i=function(n){return new u(n)},t=x(h,function(n,r,t){return n===e?r(t,t):n instanceof u?r(void 0,n.v):o(function(n){return r(n,t)},n)}),n=c.curry(function(n,r){return t(r,n)});return{get:e,put:i,modify:function(t){return o(function(n){var r=t(n);return o(function(){return h(r)},i(r))},e)},run:n}},Object.defineProperty(n,"__esModule",{value:!0})});

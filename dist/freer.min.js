!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("infestines")):"function"==typeof define&&define.amd?define(["exports","infestines"],r):r(n.freer={},n.I)}(this,function(n,f){"use strict";function c(n,r){this.p=n,this.s=r}function r(n){this.v=n}function t(n){this.f=n}var u=function(n){return Promise.resolve(n)},s=function(n){return n instanceof r},e=(0,f.id)(function(n,r){this.e=n,this.c=r}),i=function(n,r){return new e(n,r)},a=function(n){return n instanceof e},v=function(n,r){return a(n)?i(n.e,new c(n.c,r)):i(n,r)},o=function(n,r){return s(r)?n(r.v):v(r,n)},l=function(r,n){return s(n)?p(r(n.v)):v(n,function(n){return p(r(n))})},d=function(n,r){return s(n)?l(n.v,r):v(n,function(n){return l(n,r)})},p=function(n){return new r(n)},h=f.curry(o),y=f.curry(l),w=f.curry(d),m={map:l,of:p,ap:d,chain:o},x=f.curry(function(i,o){return function t(n,r){if(s(n))return i(n.v,r);var u,e=void 0;return u=a(n)?(e=n.c,n.e):(e=p,n),o(u,function(n,r){return t(function(n,r){for(;!f.isFunction(n);){var t=n.p;for(n=n.s;!f.isFunction(t);)n=new c(t.s,n),t=t.p;var u=t(r);if(!s(u))return v(u,n);r=u.v}return n(r)}(e,n),r)},r)}}),F=x(u,function(n,r){return null!=(t=n)&&f.isFunction(t.then)?n.then(r):h(r,n);var t}),b=function(){var r=void 0,n=new Promise(function(n){return r=n});return n.fill=r,n},P=x(u,function(n,r){return h(r,n instanceof t?function(n){var r=b(),t=void 0;n(function(n){return t=b(),r.fill(n),t}).then(function(n){t=null,r.fill(n)});var u=function(n){return t?(r=b(),h(e,n)):p(n)},e=function(n){return t.fill(n),h(u,r)};return h(u,r)}(n.f):n)});n.of=p,n.chain=h,n.map=y,n.ap=w,n.Free=m,n.run=function(r){return s(r)?r.v:function(n){throw Error("Expected a pure value, but got: "+r)}()},n.runAsync=F,n.from=function(n){return new t(n)},n.toAsync=P,n.handler=x,n.Reader=function(){var u=new function(){},e=f.curryN(2,function(t){return x(p,function(n,r){return n===u?r(t):h(r,n)})}),n=f.curry(function(r,t){return h(function(n){return e(r(n),t)},u)});return{ask:u,local:n,run:e}},n.State=function(){function u(n){this.value=n}var e=new function(){},i=function(n){return new u(n)},t=x(p,function(n,r,t){return n===e?r(t,t):n instanceof u?r(void 0,n.value):h(function(n){return r(n,t)},n)}),n=f.curry(function(n,r){return t(r,n)});return{get:e,put:i,modify:function(t){return h(function(n){var r=t(n);return h(function(){return p(r)},i(r))},e)},run:n}},Object.defineProperty(n,"__esModule",{value:!0})});
